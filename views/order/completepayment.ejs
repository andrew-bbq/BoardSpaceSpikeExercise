<!DOCTYPE html>
<html>

<head>
    <title>Complete Payment</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Custom Style Sheets -->
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lobster|Nunito|Bebas Neue|Comfortaa">
    <link rel='stylesheet' href="/stylesheets/navbar.css" />

    <style>
        ul {
            padding-left: 2%;
            width: 96%;
        }

        ul li {

            border-bottom: 1px solid #000;
            padding: 12px;
            font-size: 18px;
            display: block;
            position: relative;
        }

        .priceDisplay {
            width: 100%;
        }

        .cartDiv {
            border-radius: 20px;
            border: 2px solid #000;
            background-color: #dfd;
            padding: 0;
        }

        .close {
            color: #aaa;

            cursor: pointer;

            position: absolute;
            top: 50%;
            right: 0%;

            padding: 6px 10px;
            transform: translate(0%, -50%);
        }

        .close:hover {
            color: #000;
        }
    </style>

</head>

<body>
    <!-- Topbar -->
    <%- include('partials/topbar', {page: "Cart"});%>

    <div class="box">
        <ul id="cartList">
            <% let subtotal=0 %>
                <% for (let itemId in cart) { console.log(itemId); %>
                    <li>
                        <% let tempPrice=cart[itemId].price * cart[itemId].count; subtotal +=tempPrice; %>
                            <%=cart[itemId].count%>x <%=cart[itemId].name%> <span
                                        style="position: absolute; right: 40px;">$<%=tempPrice.toFixed(2)%>
                                            </form>
                    </li>
                    <% } %>
        </ul>
        <% let salesTax=subtotal * 0.05; let tip=subtotal*0.15; %>
            <div class="float-right mt-3" style="margin-right:5vw"><select class="form-control" onchange="document.getElementById('hiddenpickup').value = this.value; document.getElementById('car-input').style.display = (this.value =='1') ? 'block': 'hidden';"><option value="1">Pickup</option><option value="0">Delivery</option></select></div>
            <div id="car-input" class="float-right mt-3" style="margin-right:5vw"><input class="form-control" onchange="document.getElementById('hiddencar').value = this.value" /></div>
            <div class="priceDisplay" id="subTotalDisplay"><span style="position: relative; left: 3%;">Subtotal: $<%=
                        (subtotal).toFixed(2); %></span></div>
            <div class="priceDisplay" id="taxDisplay"><span style="position: relative; left: 3%;">Sales Tax: $<%=
                        (salesTax).toFixed(2); %></span></div>
            <div class="priceDisplay" id="tipDisplay"><span style="position: relative; left: 3%;">Forced Tip: $<%=
                        (tip).toFixed(2); %></span></div>
            <div class="priceDisplay" id="totalDisplay"><span style="position: relative; left: 3%;">Total: $<%=
                        (subtotal + salesTax + tip).toFixed(2); %></span></div>
            <br />
    </div>
    <br />

    <div class="text-center align-center">
        <form action="/order/completepayment" method="POST">
            <input type="hidden" id="hiddencar" name="car" value="" />
            <input type="hidden" id="hiddenpickup" name="pickup" value="1" />
            <input type="hidden" name="price" value="<%=(subtotal + salesTax + tip).toFixed(2)%>" />
            <input type="hidden" name="card" value="<%=card.id%>" />
            <input type="submit" id="orderButton" class="main-button text-center" value="Confirm Order" />
        </form>
    </div>
</body>
<script src="/javascripts/global.js"></script>

</html>